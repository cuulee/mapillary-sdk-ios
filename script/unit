#!/bin/bash

CURRENT_DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"
PARRENT_DIR="$(dirname "$current_dir")"

cd MapillarySDK

echo "Generating workspace"
pod install

echo "Running tests..."

ls -al

xcodebuild test-without-building \
           -workspace MapillarySDK.xcworkspace \
           -scheme Test \
           -configuration Debug \
           -destination 'platform=iOS Simulator,OS=11.0.1,name=iPhone 6' 2>&1 | /usr/local/bin/ocunit2junit

echo "Collecting code coverage..."
#/usr/local/bin/slather coverage --cobertura-xml --scheme Test --output-directory ./cobertura/ --workspace ./MapillarySDK.xcworkspace --source-directory ./MapillarySDK ./MapillarySDK.xcodeproj

echo "Copying reports..."
mkdir -p ../test_results/unit
mkdir -p ../test_results/cobertura
cp -a test-reports/. ../test_results/unit/
cp -a cobertura/cobertura.xml ../test_results/cobertura/coverage.xml
echo "DONE."